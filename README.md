# QuoteFetcher
A simple web application that fetches quotes from an API and displays it to the user. Created with Pyramid.
## Getting Started
### Windows
1. Clone git repository `git clone https://github.com/peterrayshen/QuoteFetcher.git`
2. Go to project directory `cd ...\quotefetcher`
3. Install Virtualenv in a new directory called `\venv` `python -m venv .\venv`
4. Install dependencies `venv\Scripts\python setup.py develop`
5. Run server using `venv\Scripts\pserve development.ini`
6. View server on `localhost:6543`
### Unix
1. Install Virtualenv `virtualenv --no-site-packages venv`
2. Activate Virtualenv `venv/bin/activate`
3. Clone git repository `git clone https://github.com/peterrayshen/QuoteFetcher.git`
4. Go to project directory `cd quotefetcher`
5. Install dependencies `python setup.py develop`
6. Run server using `pserve development.ini`
7. View server on `localhost:6543`
## SQL Database
### Requests
Page requests are stored into the database according to the following table model:
```
class Request(Base):
    __tablename__ = 'requests'
    uid = Column(Integer, primary_key=True)
    session_id = Column(Text, ForeignKey('sessions.session_id'))
    page = Column(Text, nullable=False)
    time = Column(Time, default=dt.utcnow().time())
    date = Column(Date, default=dt.utcnow().date())
```
### Sessions
Browsing sessions are stored into the database according to the following table model:
```
class Session(Base):
    __tablename__ = 'sessions'
    uid = Column(Integer, primary_key=True)
    session_id = Column(Text, nullable=False)
    requests = relationship("Request")
```
As seen, there is a one-to-many relationship between sessions and requests. Each session is binded to multiple requests.
#### Session ID
Each browsing session holds a unique string ID generated by the UUID class in Python
```
import uuid
session_id = str(uuid.uuid4())
```
## API
### Querying requests/sessions
#### Sessions
* `GET` `/api/sessions` - returns every `session` in the database formatted as a `json` :
```
     {
         "sessions": [
              {
                  "session1_id": "<session1_id>",
                  "requests": ["request1_info", "request2_info, ...]
              },
              {
                  "session2_id": "<session2_id>",
                  "requests": ["request1_info", "request2_info, ...]
              },
              ...
          ]
     }
``` 
* `GET` `/api/sessions/<session_id>` - returns a `session` corresponding to `<session_id>`:
```
     {
            "session_id": "<session_id>",
            "requests:": ["request1_info", "request2_info, ...]
     }
```
#### Requests
* `GET` `/api/requests` - returns every `request` in the database formatted as a `json`:
Example:
```
     {
         "requests": [
             {
                 "session_id": "b2668fa6-e3f1-4bd2-8123-06e46dae5725",
                 "page url": "/",
                 "date": "2017-10-31",
                 "time": "00:19:04.645899"
             },
             {
                 "session_id": "ddc9188a-ae1f-467c-bdd5-caf9e945bb85",
                 "page url": "/quotes",
                 "date": "2017-10-31",
                 "time": "00:19:04.645899"
             },
             ...
```
* `GET` `/api/requests/<uid>` - returns a `request` corresponding to `<uid>`
* `GET` `/api/requests/session/<session_id>` - returns every `request` corresponding to `<session_id>`
* `GET` `/api/requests/date/<date>` - returns every `request` during `<date>` in the form `YYYY-MM-DD`


